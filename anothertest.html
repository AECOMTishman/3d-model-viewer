<body></body>
<script src="http://gamingJS.com/Three.js"></script>
<script src="http://gamingJS.com/physi.js"></script>
<script src="http://gamingJS.com/ChromeFixes.js"></script>

<script>
  Physijs.scripts.ammo = 'http://gamingJS.com/ammo.js';
  Physijs.scripts.worker = 'js/physijs_worker.js';

  var scene = new Physijs.Scene({ fixedTimeStep: 2 / 60 });
  scene.setGravity(new THREE.Vector3( 0, -100, 0 ));

  var width = window.innerWidth,
      height = window.innerHeight,
      aspect_ratio = width / height;
  var camera = new THREE.PerspectiveCamera(75, aspect_ratio, 1, 10000);

  camera.position.set( 200, 200, 600 );
  camera.lookAt(new THREE.Vector3(0,-100,0));
  scene.add(camera);

  var renderer = new THREE.CanvasRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMapEnabled = true;
  document.body.appendChild(renderer.domElement);
  document.body.style.backgroundColor = '#ffffff';

  var myTarget = new THREE.Object3D();
  myTarget.position.set( 0, 0, 0 );

  var spotLight = new THREE.SpotLight( 0xffffff );
  spotLight.position.x = 0;
  spotLight.position.y = 400;
  spotLight.position.z = 0;
  spotLight.target = myTarget;
  spotLight.castShadow = true;
  spotLight.shadowMapWidth = 1000;
  spotLight.shadowMapHeight = 1000;
  spotLight.shadowCameraNear = 50;
  spotLight.shadowCameraFar = 2000;
  spotLight.shadowCameraFov = 45;
  spotLight.shadowCameraVisible = true;

  var sphere = new THREE.SphereGeometry( 100, 16, 8 );
  var orb_mesh = new THREE.Mesh( sphere, new THREE.MeshBasicMaterial( { color: 0xffaa00 } ) );
  orb_mesh.scale.set( 1, 1, 1 );
  spotLight.add( orb_mesh );

  var m1 = new Physijs.BoxMesh(new THREE.CubeGeometry(20, 150, 20), new THREE.MeshBasicMaterial({color:0x00ff00}));
  m1.castShadow = true;
  m1.receiveShadow = true;
  var m2 = new Physijs.BoxMesh(new THREE.CubeGeometry(20, 150, 20), new THREE.MeshBasicMaterial({color:0xff0000}));
  m2.castShadow = true;
  m2.receiveShadow = true;
  var m3 = new Physijs.BoxMesh(new THREE.CubeGeometry(20, 150, 20), new THREE.MeshBasicMaterial({color:0x0000ff}));
  m3.castShadow = true;
  m3.receiveShadow = true;
  var m4 = new Physijs.BoxMesh(new THREE.CubeGeometry(20, 150, 20), new THREE.MeshBasicMaterial({color:0x000000}));
  m4.castShadow = true;
  m4.receiveShadow = true;
  var ground = new Physijs.BoxMesh(new THREE.CubeGeometry(1000, 10, 1000), new THREE.MeshBasicMaterial({color:0xdddddd}), 0);
  ground.castShadow = false;
  ground.receiveShadow = true;  

  m1.__dirtyPosition = true;
  m1.__dirtyRotation = true;
  m1.position.x = -30;
  m2.__dirtyPosition = true;
  m2.position.x = -10;
  m3.__dirtyPosition = true;
  m3.position.x = 10;
  m4.__dirtyPosition = true;
  m4.position.x = 30;
  ground.__dirtyPosition = true;
  ground.position.y = -300;

  /*var constraint = new Physijs.PointConstraint(
      m1, // First object to be constrained
      m2, // OPTIONAL second object - if omitted then physijs_mesh_1 will be constrained to the scene
      new THREE.Vector3( 0, 10, 0 ) // point in the scene to apply the constraint
  );

  scene.addConstraint( constraint );*/

  scene.add(m1);
  scene.add(m2);
  scene.add(m3);
  scene.add(m4);

  scene.add(ground);

  scene.add( myTarget );
  scene.add( spotLight );

  m1.setAngularVelocity(new THREE.Vector3(1, 0, 0));

  document.addEventListener('keydown', function(event) {
    switch(event.keyCode) {
      case 13:
        m1.setAngularVelocity(new THREE.Vector3(1, 0, 0));
        break;

      case 100:
        m2.setAngularVelocity(new THREE.Vector3(1, 0, 0));
        break;

      case 101:
        m3.setAngularVelocity(new THREE.Vector3(1, 0, 0));
        break;

      case 102:
        m4.setAngularVelocity(new THREE.Vector3(1, 0, 0));
        break;
    }
  });

  // Animate motion in the game
  function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  }
  animate();

  // Run physics
  function gameStep() {
    scene.simulate();
    // Update physics 60 times a second so that motion is smooth
    setTimeout(gameStep, 1000/60);
  }
  gameStep();
</script>